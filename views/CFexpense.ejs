<!DOCTYPE html>
<html lang="en">
    <%-include('./partials/head.ejs')%>
<body>
    <nav class="navbar bg-black">
      <div class="container-fluid">
        <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
          <img 
          width="30"
          hegith="30"
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
         </span>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <h5>
              <a
                class="nav-link breadcrumb-item active"
                aria-current="page"
                href="/employee/Onboard"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                style="color: #fff !important"
              >
               Expense
              </a>
            </h5>
          </li>
        </ul>
        <%-include('./partials/USER.ejs')%>
        <%-include('./partials/inactive.ejs')%>
      </div>
    </nav>
</body>
<!-- display section -->
            <!--bread crum div -->
            <div class="d-flex justify-content-between p-2 m-1 bg-success-subtle ">
              <%if(user.role === "Admin" || user.jobTittle === "CFO" || user.Department === "Accounting" ){%>
                  <li class="nav-item dropdown btn btn-success">
                    <label class="nav-link dropdown-toggle"  role="button" data-bs-toggle="dropdown" aria-expanded="true">
                     New Expense category
                    </label>
                    <form class="dropdown-menu p-3" id="category">
                        <input class="form-control" placeholder="Enter new category" name="categoty" type="text">
                        <li><hr></li>
                        <%if(user.role === "Admin" || user.jobTittle === "CFO" ){%>
                          <button class=" btn btn-dark " >Create New</button>
                          <%}%>
                          <li><hr></li>
                          
                        <%if(expenseCat.length > 0){%>
                          <%expenseCat.sort((a,b)=>{return b.createdAt - a.createdAt}).forEach((cat)=>{%>
                            <li class="d-flex justify-content-between">
                              <small><%=cat.NAME%></small>
                              <%if(user.role === "Admin" || user.jobTittle === "CFO" ){%>
                              <a href="/api/v1/Category/delete/<%=cat._id%>" class="btn btn-warning">Delete</a>
                              <%}%>
                            </li>
                            <li><hr></li>
                         <%})%>
                         <%}%> 

                    </form>
                  </li>
                  <%}%>
                
                  <button class="btn btn-success" onclick="document.getElementById('myModal').style.display='block'">REQUEST EXPENSE</button>
               </div>
            <div class="h-59 p-1 d-flex flex-column" >
                 <%if(Expenses.length > 0){%>
                   <%Expenses.sort((a,b)=>{return b.createdAt - a.createdAt}).forEach(expense=>{%>
                     <span onclick="location.assign('/api/v1/EXP/<%=expense._id%>')" class="list-group position-relative mb-2" title="Expense for <%=expense.Amount%>">
                       <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" >
                           <small class="position-absolute top-0  start-50 translate-middle badge rounded-pill bg-warning"title='grand total of this bill'>
                            â‚¦<%=expense.Amount%>
                              <%if(expense.status==='Approved'){%>
                             <span class="badge bg-secondary">EXPENSED</span>
                             <%}%>
                           </small>
                           <h6>
                               <a href="/api/v1/EXP/<%=expense._id%>" class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" >
                               
                                  EXP/<%=expense.refNo%>
                                </a> 
                                </h6>
                         </div> 
                         
                       </span>
                   <%})%>
                 <%}else{%>
                <p>Nothig to display</p>
                 <%}%>
             </div>
    </div>

     <!-- The Modal -->
     <div id="myModal" class="modal flex items-center flex-col justify-center gap-3 shadow">
      <!-- Modal content -->
      <div class="modal-body modal-content container">
          <form  class="row g-3 needs-validation" id="expenseform" >
              <div class=" d-flex justify-content-between">
                
                    <!-- <h5>Register Payment</h5> -->
                   <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABj0lEQVR4nO2VwUrDQBCG9yWqb9DePSkIveyAh14Ec9jVi2QOPof2abx7KkJt00KCVqF489CTJLlZe3YlpVuWGLBNmo2t88MPYQd25tuZ3TBGIpH+nzw/9IZByM213ui95gXh7bqxRP3H6Njzow6zpUEQqcSeH3aHQdwc+rEz8KNYr68cC+Jm8q3XrQNs2owAVhR1IKARKiZ9gs3Tu5WcdeJZcWZLWwcAF1d7ILHNhfvMBc7KusRc4Awkjrhwb5Kcmyleug4XOAWJSrssADByzHOe41nh4kHil7mxCbDu2Pw2QpDKM8+dFyJpYfrkKwBQXODHiXNZy3H62M7a0NYIgQkh8XptAC7wJb1R/eBw7rIA6ov9MyBGOTrgfv4VAC5wmgPgZyt1grINGbkJACo228QIEYCsuANPb0dWDATAqAOKRkjSJcbK336gH5ncsR/Z/YOnJpPJ0p1uv3Dstd5Sap8vPW60ygMwi9AuGlNG8doEsLMd6HT7qVnuFY6NGxbvwNa/QkAAaK8DJBKJbYW+AX7aIYn4KzT3AAAAAElFTkSuQmCC"
                   width="40"
                   height="40"
                   >

                 <h5> NEW EXPENSE</h5>
                  <svg xmlns="http://www.w3.org/2000/svg" onclick="document.getElementById('myModal').style.display='none'" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                </div>

                <div class="col-md-4">
                  <label for="billreferenceNo" class="form-label">EXPENSE TYPE</label>
                  <!-- <input type="text" id="billreferenceNo" list="referenceNo" autocomplete="off" required class="form-control border" placeholder="Search Expense category" required/> -->
                  <select id="billreferenceNo"  name="expenseCategory" class="form-select border" required>
                   <!-- display options for Bills -->
                   <option >Choose...</option>
                   <option value="Salary">Salary</option>
                   <%if(expenseCat.length > 0){%>
                    <%expenseCat.forEach((cat)=>{%>
                   <option value="<%=cat.NAME%>"><%=cat.NAME%></option>
                   <%})%>
                   <%}%> 
                  </select>
              </div>

              <div class="col-md-4">
                  <label for="customer" class="form-label">RAISED BY</label>
                  <input id="customer" class="form-control border" name="raisedBy" value="<%=user.firstName%> <%=user.lastName%> [Accountant] " disabled>
                  <input type="text" value="<%=user._id%>"id="manager" name="manager" hidden disabled>
                  <input type="text" value="<%=user.workLocation%>"name="WHID" hidden disabled>
                  <input type="text" value="<%=user.Signature%>"name="Signature" hidden disabled>
                </div>

              <div class="col-md-4">
                  <label for="date" class="form-label">DATE</label>
                  <input type="date" placeholder="" required class="form-control border" id="date" name="Date"/>
              </div>
              <div class="col-md-4">
                <label for="PAYEE" class="form-label">BENEFICIARY</label>
                <input type="text" placeholder="Payee" required class="form-control border" autocomplete="off" id="PAYEE" name="PAYEE"/>
            </div>

            <div class="col-md-4">
              <label for="BankAccount" class="form-label">BENEFICIARY ACCOUNT NUMBER</label>
              <input type="text" placeholder="Bank Account Number" required class="form-control border" autocomplete="off" id="payeebankAccount" name="Payee Account"/>
          </div>

          <div class="col-md-4">
            <label for="BankName" class="form-label">BENEFICIARY BANK </label>
            <input type="text" placeholder="Payee Bank Name" required class="form-control border" autocomplete="off" id="BankName" name="payeeBankName"/>
        </div>
            <div class="col-md-4">
              <label for="DriverNumber" class="form-label">ATTACHMENT</label>
              <input type="file" class="form-control border" id="DriverNumber" name="DriverNumber"/>
          </div>
          <div class="col-md-4">
            <label for="Amount" class="form-label">AMOUNT â‚¦</label>
            <input type="number" inputmode="numeric" placeholder="Enter amount" required class="form-control border" id="Amount" name="Amount"/>
          </div>
             <div class="col-md-4">
              <label for="remark" class="form-label">REMARKS</label>
              <textarea type="text" id="remark"  name="remark"  class="form-control" autocomplete="off" autocapitalize="on" placeholder="Remark" ></textarea>
            </div>

              <div class="col-md-4  ">
                <label for="InvoiceNo" class="form-label"> All done!</label>
                  <button class="btn btn-success form-control" > SUBMIT FOR APPROVAL</button>
              </div>

            </form>
      </div>
  </div>
    <!-- ends here -->
    <script>
      const  categoryForm = document.getElementById('category')
categoryForm.addEventListener('submit',async (e)=>{
  e.preventDefault()
const endPoint ="/api/v1/expense/Category/create"
const request = await fetch(endPoint,{

method:'POST',

body: JSON.stringify({NAME:categoryForm.categoty.value}),

headers: {"Content-Type": 'application/json'}

})

const response = await request.json()

response.message? alert(response.message) : alert(response.error)

response.message? inventoryForm.reset() : ""

categoryForm.reset()
})

// for creating new expense  
const EXPENSEFORM = document.getElementById('expenseform')
   EXPENSEFORM.addEventListener('submit',async(event) => {
    
    event.preventDefault()
    // get date atributes field
    const manager = document.getElementById('manager').value;
    const request = await fetch(`/api/v1/Expense/${manager}`,{
      method: 'POST',
      body:JSON.stringify({
        category:EXPENSEFORM.expenseCategory.value,
        refNo:Math.floor(Math.random()*100000),
        Attachment:'',
        Signature:EXPENSEFORM.Signature.value,
        initiatorId:EXPENSEFORM.raisedBy.value,
        WHID:EXPENSEFORM.WHID.value,
        Amount:EXPENSEFORM.Amount.value,
        Date:EXPENSEFORM.Date.value,
        payee:EXPENSEFORM.PAYEE.value,
        remarks:EXPENSEFORM.remark.value,
        payeebankAccount:EXPENSEFORM.payeebankAccount.value,
        payeeBankName:EXPENSEFORM.payeeBankName.value,
        
      }),
      headers: {"content-type": "application/json"}
    })
    const response =  await request.json()
    if(response.message){
      alert(response.message)
      location.reload()
    }else if(response.error){
      alert(response.error)
    }
  })

</script>
</html>