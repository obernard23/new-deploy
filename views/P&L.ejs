<!DOCTYPE html>
<html lang="en">
  <%-include('./partials/head.ejs')%>
  <%-include('./partials/inactive.ejs')%>
  <style>
    h3 {
  color: #262626;
  font-size: 17px;
  line-height: 24px;
  font-weight: 700;
  margin-bottom: 4px;
}

p {
  font-size: 17px;
  font-weight: 400;
  line-height: 20px;
  color: #666666;

  &.small {
    font-size: 14px;
  }
}

.go-corner {
  display: flex;
  align-items: center;
  justify-content: center;
  position: absolute;
  width: 32px;
  height: 32px;
  overflow: hidden;
  top: 0;
  right: 0;
  background-color: #00838d;
  border-radius: 0 4px 0 32px;
}

.go-arrow {
  margin-top: -4px;
  margin-right: -4px;
  color: white;
  font-family: courier, sans;
}

.card1 {
  display: block;
  position: relative;
  max-width: 262px;
  background-color: #f2f8f9;
  border-radius: 4px;
  padding: 32px 24px;
  margin: 12px;
  text-decoration: none;
  z-index: 0;
  overflow: hidden;

  &:before {
    content: "";
    position: absolute;
    z-index: -1;
    top: -16px;
    right: -16px;
    background: #00838d;
    height: 32px;
    width: 32px;
    border-radius: 32px;
    transform: scale(1);
    transform-origin: 50% 50%;
    transition: transform 0.25s ease-out;
  }

  &:hover:before {
    transform: scale(21);
  }
}

.card1:hover {
  p {
    transition: all 0.3s ease-out;
    color: rgba(255, 255, 255, 0.8);
  }
  h3 {
    transition: all 0.3s ease-out;
    color: #ffffff;
  }
}

/* card 2 */
.card2 {
  display: block;
  top: 0px;
  position: relative;
  max-width: 262px;
  background-color: #f2f8f9;
  border-radius: 4px;
  padding: 32px 24px;
  margin: 12px;
  text-decoration: none;
  z-index: 0;
  overflow: hidden;
  border: 1px solid #f2f8f9;

  &:hover {
    transition: all 0.2s ease-out;
    box-shadow: 0px 4px 8px rgba(38, 38, 38, 0.2);
    top: -4px;
    border: 1px solid #cccccc;
    background-color: white;
  }

  &:before {
    content: "";
    position: absolute;
    z-index: -1;
    top: -16px;
    right: -16px;
    background: #00838d;
    height: 32px;
    width: 32px;
    border-radius: 32px;
    transform: scale(2);
    transform-origin: 50% 50%;
    transition: transform 0.15s ease-out;
  }

  &:hover:before {
    transform: scale(2.15);
  }
}

td{
    border: 1px solid rgb(192, 178, 178);
    text-align: center;
}
td:nth-child(4){
    color:rgb(0, 1, 2) !important;
    font-size: smaller !important;
}

  </style>
  <body onload="getData()">
    <nav class="navbar bg-black">
      <div class="container-fluid">
        <span class="navbar-brand" onclick="history.back()"  title="Back">
          <img 
          width="30"
          hegith="30"
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
         </span>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <h5>
              <a
                class="nav-link breadcrumb-item active"
                aria-current="page"
                href="/"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                style="color: #fff !important"
              >
              Profit & Loss
              </a>
            </h5>
          </li>
        </ul>
        <%-include('./partials/USER.ejs')%>
      </div>
    </nav>

    <div class=" p-2 ">

        <div class="card bg-dark text-gray justify-content-between" style="color: #ffffff !important;">
            <form id="dataForm">
                
              <div class="card-body d-flex justify-content-between align-items-center">
                <div class="col-md-2">
                    <label for="pricelist" class="form-label">Start Date</label>
                    <input type="date" name="Startdate" id="date" required class="form-control border" >
                </div> 
                <span>
                    <img width="50" height="50" src="https://img.icons8.com/stickers/100/arrow.png" alt="arrow"/>
                </span>
                <!-- end date  -->
                <div class="col-md-2">
                    <label for="pricelist" class="form-label">End Date</label>
                    <input type="date" name="Enddate" id="date" required class="form-control border" >
                </div>
                <button class="btn btn-success p-2"><img width="14" height="14" src="https://img.icons8.com/material-outlined/24/search--v1.png" alt="search--v1"/></button>
              </div>
              </form>
            </div>
            <hr>
            <!-- display from here -->
            <table  class="w-100 bg-light ">
                <thead>
                    <td class="border p-1 ">S/N</td>
                    <td  class="border p-1">Batch</td>
                    <td  class="border p-1">Channel</td>
                    <td  class="border p-1">SKU</td>
                    <td  class="border p-1" title="Buying Price">BP</td>
                    <td  class="border p-1" >Inv No</td>
                    <td  class="border p-1" title="Invoice date">Date</td>
                    <td  class="border p-1" title="WareHouse invoice Number">WH No:</td>
                    <td  class="border p-1" title="Product category">category</td>
                    <td  class="border p-1" title="Van Margin">Scale</td>
                    <td  class="border p-1" title="Super Markert Price">SM-P</td>
                    <td  class="border p-1" title="Super Markert Qty">SM-Q</td>
                    <td  class="border p-1" title="Super Markert Gain">SM-G</td>
                    <td  class="border p-1" title="whole sale Price">WH-P</td>
                    <td  class="border p-1" title="whole sale Quantity">WH-Q</td>
                    <td  class="border p-1" title="whole sale Gain">WH-G</td>
                    <td  class="border p-1" title="Van Price">V-P</td>
                    <td  class="border p-1" title="Van Qty">V-Q</td>
                    <td  class="border p-1" title="Van Gain">V-G</td>
                    <!-- <td  class="border p-1" title="Total Qty Sold">TQS</td>
                    <td  class="border p-1" title="Total Profit">TP</td> -->
                </thead>
                <tbody id="pnl"></tbody>
            </table>

    </div>
    
   <!-- MODAL -->
   <div id="loading" class="modal flex items-center flex-col justify-center gap-3">
    <div class="modal-body d-flex justify-content-center container">
      <h6 class="text-light">Please wait...</h6>
    </div>
  </div>

  </body>
<script>
    const formatter = new Intl.DateTimeFormat('us-as')
    const getData = async ()=>{
      document.getElementById('loading').style.display='block'
        const request = await fetch('/api/v1/Getfulldb',{
        method:'GET',
        headers:{'Content-Type': 'application/json'},
    })
        const response = await request.json()
        response ? document.getElementById('loading').style.display='none' : ''

    let data = []

    response.invoice.filter((inv)=>{return inv.billStatus !== "Cancelled" }).map((invoice) => {
       
        for (let index = 0; index < invoice.orders.length; index++) {
            const element = invoice.orders[index];

            data.push({
            batch:element.item.Batch ? element.item.Batch :'',
            Vendor:element.item.Vendor,
            catregory:element.item.category,
            scale:element.scale,
            sku:element.item.Name,
            BP:element.item.vendor_Price,
            invNo:invoice.billReferenceNo,
            wh:invoice.invoicelocation,
            Channel:invoice.priceList,
            SM_P:element.item.Market_Price,
            SM_Q:invoice.priceList === "Market_Price" ? element.Qty :0,
            SM_M:invoice.priceList === "Market_Price" ? element.item.Market_Price - element.item.vendor_Price : 0 ,
            SM_G:invoice.priceList === "Market_Price" ? (element.item.Market_Price - element.item.vendor_Price) * element.Qty : 0,
            WH_P:element.item.WareHouse_Price,
            WH_Q:invoice.priceList === "WareHouse_Price" ? element.Qty :0,
            WH_M:invoice.startDate,
            WH_G:invoice.priceList === "WareHouse_Price" ? (element.item.WareHouse_Price - element.item.vendor_Price) * element.Qty : 0,
            V_P:element.item.Van_Price,
            V_Q:invoice.priceList === "Van_Price" ? element.Qty :0,
            V_M:invoice.priceList === "Van_Price" ? element.item.Van_Price - element.item.vendor_Price : 0 ,
            V_G:invoice.priceList === "Van_Price" ? (element.item.Van_Price - element.item.vendor_Price) * element.Qty : 0

        })
           }


        //    console.log( invoice)
    })








    // start the P&L here

    const renderDOm = async (data)=>{
        let count =  data.length - data.length + 1
        tHead = document.querySelector('table')
        // render result 
        if(data ){
        //   downloadBTN.classList.remove('d-none')
        let tbody = document.getElementById('pnl')
        // document.getElementById('error').innerText = ''
        tbody.innerHTML =''
        // tHead.classList.remove('d-none')
        data.map(async(element)=>{
        // let NameOfCust = await response.customers.filter((customer) =>{return customer._id.toString() === element.customerId.toString()}).map((customer) => {return customer.Username})
       
            //excell data
            // data.push({CUSTOMER_NAME:NameOfCust[0],DATE:formatter.format(new Date(element.Date)),REF:element.ReferenceNo,DEBIT:element.DebitAmount,CREDIT:element.CreditAmount,BALANCE:element.Balance})

        let tr = document.createElement('tr')
        let counter = document.createElement('td')
        let BatchNo = document.createElement('td')
        let Channel = document.createElement('td')
        let SKU = document.createElement('td')
        let BP = document.createElement('td')
        let Inv = document.createElement('td')
        let WH = document.createElement('td')
        let SM_p = document.createElement('td')
        let SM_Q = document.createElement('td')
        let SM_G = document.createElement('td')
        let catregory = document.createElement('td')
        let scale = document.createElement('td')

        let WH_p = document.createElement('td')
        let WH_Q = document.createElement('td')
        let WH_G = document.createElement('td')
        let WH_M = document.createElement('td')

        let V_p = document.createElement('td')
        let V_Q = document.createElement('td')
        let V_G = document.createElement('td')
        let V_M = document.createElement('td')
        let TQS = document.createElement('td')
        let TP = document.createElement('td')
        // assign element to variable
        counter.innerText = `${count++}`
        
       
        BatchNo.innerText = element.batch
        Channel.innerText = element.Channel
        // CustomerType.innerText = formatter.format(new Date(element.Date))
        SKU.innerText = `${element.sku}`
        SKU.setAttribute('title',element.sku)
        BP.innerText = `₦${element.BP}`
        Inv.innerText = element.invNo
        WH.innerText = element.wh

        SM_p.innerText = `₦${Math.round(element.SM_P)}`
        SM_Q.innerText = `${Math.round(element.SM_Q)}`
        SM_G.innerText = `₦${Math.round(element.SM_G)}`
        catregory.innerText = element.catregory
        scale.innerText = element.scale

        WH_p.innerText =`₦${Math.round(element.WH_P)}`
        WH_Q.innerText = `${Math.round(element.WH_Q)}`
        WH_G.innerText = `₦${Math.round(element.WH_G)}`
        WH_M.innerText = formatter.format(new Date(element.WH_M))

        V_p.innerText = `₦${Math.round(element.V_P)}`
        V_Q.innerText = `${Math.round(element.V_Q)}`
        V_G.innerText = `₦${Math.round(element.V_G)}`
        V_M.innerText = Math.round(element.V_M)

        
        // add style 
        tr.classList.add('border')
        counter.classList.add('border')
        // append element to table body
        tr.appendChild(counter)
        tr.appendChild(BatchNo)
        tr.appendChild(Channel)
        tr.appendChild(SKU)
        tr.appendChild(BP)
        tr.appendChild(Inv) 
        tr.appendChild(WH_M)
        tr.appendChild(WH)
        tr.appendChild(catregory)
        tr.appendChild(scale)
        tr.appendChild(SM_p)
        tr.appendChild(SM_Q)
        tr.appendChild(SM_G)

        tr.appendChild(WH_p)
        tr.appendChild(WH_Q)
        tr.appendChild(WH_G)

        tr.appendChild(V_p)
        tr.appendChild(V_Q)
        tr.appendChild(V_G)

        // tr.appendChild(TQS)
        // tr.appendChild(TP)
        tbody.append(tr)
    })
        }else{
            document.getElementById('pnl').innerText = "No Matching Data Found"
        }
    }
    renderDOm(data)
}

</script>
</html>
