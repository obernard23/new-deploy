<!DOCTYPE html>
<html lang="en">
    <%-include('./partials/head.ejs')%>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/icomoon/style.css">

    <link rel="stylesheet" href="/owl.carousel.min.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/bootstrap.min.css">
    
    <!-- Style -->
    <link rel="stylesheet" href="/style.css">
<body>
    <nav class="navbar bg-black">
      <div class="container-fluid">
        <span class="navbar-brand" onclick="history.back()" href="/" title="Back">
            <img 
            width="30"
            hegith="30"
            src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
           </span>
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item dropdown">
  
                  <h5>
                      <a class="nav-link breadcrumb-item active" aria-current="page"  role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #fff !important;">
                         SET-UP <%=warehouse.WHName.toUpperCase()%> 
                      </a>
                  </h5>
                  
                </li>
          </ul>
          <%-include('./partials/USER.ejs')%>
          <%-include('./partials/inactive.ejs')%>
      </div>
    </nav>
    <!-- form here -->
    <div class="container border mt-3 p-1" style="color: aliceblue; background-color: black;">
        <form class="row g-3 needs-validation" id="EditWareHouseForm" novalidate>
            <div class="col-md-4">
              <label for="validationCustom01" class="form-label">ALIAS</label>
              <input type="text" class="form-control" id="validationCustom01" name="WHName" value="<%=warehouse.WHName.toUpperCase()%>" required>
            </div>
            <div class="col-md-4">
              <label for="validationCustom02" class="form-label">TELEPHONE NUMBER</label>
              <input type="text" class="form-control" id="validationCustom02" value="<%=warehouse.Tel%>" name="Tel" required>
            </div>
            <div class="col-md-4">
              <label for="validationCustomUsername" class="form-label">EMAIL</label>
              <div class="input-group has-validation">
                <span class="input-group-text" id="inputGroupPrepend">@</span>
                <input type="text" class="form-control" id="validationCustomUsername" name="Email" value="<%=warehouse.Email%>" aria-describedby="inputGroupPrepend" required>
              </div>
            </div>
            <div class="col-md-6">
              <label for="validationCustom03" class="form-label">ADDRESS</label>
              <input type="text" class="form-control" id="validationCustom03" name="Address" value="<%=warehouse.Address%>" required>
            </div>
            <div class="col-md-3">
              <label for="validationCustom04" class="form-label">STATE</label>
              <input class="form-control" id="validationCustom04" name="state" value="<%=warehouse.state%>" required />
              <input type="text" id="ADMINID" value="<%=user._id%>" hidden>
              <input type="text" id="WHID" value="<%=warehouse._id%>" hidden>
            </div>
            <div class="col-md-3">
              <label for="Manager" class="form-label">MANAGER</label>
              <select type="text" class="form-select" id="Manager" name="Manager" required>
                <OPtion><%=warehouse.Manager.firstName%> <%=warehouse.Manager.lastName%> [Current]</OPtion>
                <%if(employe ){%>
                    <%employe.forEach(employe=>{%>
                      <option value="<%=employe._id%>"><%=employe.firstName%> <%=employe.lastName%></option>
                      <% })%>
                      <%}%>
              </select> 
            </div>
            <div class="col-md-3">
                <label for="StoreKeeper" class="form-label">STORE KEEPER</label>
                <select type="text" class="form-select" id="StoreKeeper" name="StoreKeeper" required>
                  <OPtion><%=warehouse.StoreKeeper.firstName%> <%=warehouse.StoreKeeper.lastName%> [Current]</OPtion>
                  <%if(employe ){%>
                  <%employe.forEach(employe=>{%>
                    <option value="<%=employe._id%>"><%=employe.firstName%> <%=employe.lastName%></option>
                    <% })%>
                    <%}%>
                </select> 
            </div>
            <div class="col-13">
                <%if(warehouse.Status){%>
                    Deactivate <%=warehouse.WHName.toUpperCase()%>
                    <%}else{%>
                        Activate <%=warehouse.WHName.toUpperCase()%>
                    <%}%>
                <label class="switch ">
                    <input type="checkbox" name="Status" <%if(warehouse.Status=== true){%>
                        checked
                    <%}%>>
                    <div class="slider "></div>
                </label>
            </div>

            
            <div class="col-12">
              <button class="btn btn-primary" type="submit">SUBMIT</button>
            </div>
          </form>
    </div>
    <!-- ends here -->
    <h6></h6>
    <div class="container border shadow">
        <div class="table-responsive custom-table-responsive" >
    
            <table class="table custom-table " style="font-size: 15px !important;">
              <thead style="color: black !important;">
                <tr >  
    
                    <th scope="col" style="color: black !important;">ACTIVITY LOG</th>
                    <th scope="col" style="color: black !important;">PRODUCT</th>
                    <th scope="col" style="color: black !important;">SCALE</th>
                    <th scope="col" style="color: black !important;">PHOTO DESC</th>
                    <th scope="col" style="color: black !important;">CRTN</th>
                    <th scope="col" style="color: black !important;">ROLL </th>
                    <th scope="col" style="color: black !important;">STATUS</th>
                </tr>
              </thead>
              <tbody>
        <%if(storeProducts.length > 0 ){%>
            <%storeProducts.sort((a,b)=>{return b.currentQty - a.currentQty}).forEach(product=>{%>
                <!-- activity log -->
                  <td  id="incoming">
                        <div class=" " scope="col">
                            <!-- Split dropstart button -->
                          <div class="btn-group dropstart" style="border-right: 1px dotted rgb(190, 190, 190) !important;" role="group">
                          <button type="button" class="btn btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                            <span class="visually-hidden">Toggle Dropstart</span>
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAADR0lEQVR4nJ2Vy08TURjF51/Qlf+CS/CFUp6FtrSdvqctbYc+gBYfVJDHQlQkIeIbwfCIC0KCMYrR6MZEKSpEHoIkujAECxsgUCQpAlNYuDjmXqBhBAbKJN9mJvf73Xu+c88wFr6Qs3n8EZvXD85dBK6gEGbeB5PLC4PTA4PDDZ2dB2vjlzUOxxEm0cfmDUQmwmGsr6/vWmtra7RuNzZDwzn8CQPyfYF4o1gstmf1fPwMNefoTRhg9/opQKp5LBZDNLpE5Pqr5rhjCQFsewCqrteh+kad6F39vYdQme1QmWxQGK3I0XOQ6yzIZk3I0pqQoTEgQ61HmkoHmYKdlSlYLWP1FIsAvxcX0dT6BPr8AjrcxpZ2+o586+3rp2BBECQrEongQ+8npCo0MyLAysoKKq/VovBmO4rbhsDd7YW+9A6C1TX029LSEswuL6ZnZiUB8/PzmJqawrlcDRhizS3Al8FhOMvrUNM9Dr5tDLamEZgaeqD1VaJ/YIguvvWgCd2v3x4IcDZHDYb4fgtwvryK+p7Iw9p5aG0uYk2oLQ54LwTp4r6BQQSrrx4OsFcJ2xYvLy/D6PJArjPT4WZqjHS46Xkbw7W6i+KAlJw8MJYEAYIg0Ev39MXLfU9wRp4HhsSCFEDYpcHA8AgCZZWSgMnJSZzOVokBgcsVO7RXbfreXXIp3oA4yuTybMij1lN5ZEoWqUotiCIiAAm1vU4gNcj7j1vQ0fVM+gRZSjBGp+dQgK+jY3CXlEoCTmUpwBi2AYqDV6C1Oqk8eZZ8Ko/SuBELBYGLoiarq6tUDhoLRB6Fll4sM+/dCdgtSfeLA0EQ8Ki1He0dnTvAW4CTmQTgcO8AHKS5IAgY+/4Ddl9A1Hw74ERGLhidnZ//OT5xKMAqkYn3UXnIrSUXy+T0iAEazmlkra653axJtM81SETypvbPX72J7377CZLTc5DQvyNdbTiut/MIhXoQCoVQW9+AQFkFotGoCDA3N7cJkCcGYAhEpR/t7OpCc2sbddGvcBgLCwvxIv8CEhPhcBhJaYcAyFRsqd3np7d95NsYbUZ2+3+9e9+DJFn2dMKAFIXiqEzJ/iGxQHxPhktCjcQC8T2xJtE+OV0+nSSTq/4BNITUZwFW2l8AAAAASUVORK5CYII="
                            width="20"height="20" >
                          </button>
                          <ul class="dropdown-menu p-2" style="overflow-y: scroll;position: fixed;z-index: 1; height:150px;">
                            <!-- Dropdown menu links -->
                            <span>History Logs</span>
                            <div>
                                <% product.ActivitiyLog.map(log=>{%>
                                        <p class="border"><%=log.message%></p>
                                <%})%>
                            </div>
                          </ul>
                      <!--ends here  -->
                        <td>
                            <%=product.productName%>
                        </td>
                        <td>
                            <%=product.ADCcode%>
                        </td>
                        <td>
                                   <!-- product scale -->
                             <img width="50" height="50" src='
                             <%if(product.image ) {%>
                                <%=product.image%>
                            <%}else{%>
                                data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9UlEQVR4nO2dT08TQRiHl8QvoNGEbbbtxXD2b2IFCREUbxrxAMabeG27RDi0BvkAJEakKibtzcgFL8aDiRdSh6MpR++WwIHYmXBS4TVTaWxaSmfLru8Cv1/yXtvkefad2c40M5aFIAiCIAiCIAiCIPtFKXVNSrkopSxLKX8rpQiljBloZlLK71LKd0qpvo6fNiI6IaV8BfjK1wdQSpnTbD0LgQwV2EhQLpcLnocpdIYKdGguFArjlmV1mXbHIoSoQIWsrpa+RKPRS6ZCyo0fkHu+REP9Lg0kkqiEOQPNLDe31CRkY2Nj03Hsse7u7jMmQprepiAj2fGDeKN/oklIpVLZ1kJischVkzmk6QPQGckDMdiLqRbiOPadAwsh4aJEewZmQiKjECL+zwNl2CFjECIg5FgOcQPoEJddAoQIfvAQIvhhQ4jgBwwhgh8qhAh+kBASAngEIfzA6KgIqdVgX5Kyj1L0eT6Nmk9TdjxVZeJxcbG9ECnlT9Pl98HeJGTM/30gr/d6Wn7f8dIh35o2qOZab1ChQ9JVBq02qF6+eL/XBtUPL0LettuCxHK863nOaNzCNV5+39raOiel3IEQ19dJvL4mJycyxhtUu10yCyFuIEKKxeUPteHKaAtXh4i6lFLPpJTbGLJcX4ToibxYLH6Mx537/4TETlpeUqlULkOI64uQqanH2ZoIXfF45LwnGXXDFyZ14d8PQT2Rx2L2hY5kQIjr+y9zx3FOdSyDQ8ivZZdeZ1I0ctP/P+WNDKdoIZOufkdol0rCJmQhs/ePLD9LfweEGAoZCaAzGuvucApCjIUMpwIXcu+W/52NISvRuZA3WXSIp0l9IZMOpFMwqR+jGjiqb1l0SAtCBL8ECBH84CFE8MOGEMEPGEIEP1QICQFIghB+eAQh/MAIQvghEYTwgyEI4YdBISgsnQh+CRAi+MFDiOCHDSGCHzCECH6oEBICkAQh/PAIQviBEYTwQyII4QdDEMIPg0JQWDoR/BIgRPCDhxDBDxtCBD9gCBH8UCEkBCAJQvjhEYTwAyMI4YdEEMIPhiCEHwaFoLB0IvglQIjgBw8hgh/2oRKCSjYxCFQILglL+nYJmF9Cyl5OKT3ONdTiFNL19fVNP4Xoi3XbHuyIUi0ZlEpfzU8hNRBypd0ppSi1L4OZmemnWkg0at8+sJBdKTlAVx09eCsrK5/qzllM+CJEXzm9traWhxTlWUZPz9kHNSFGV616ST6ff1gqlYSepPSbAwSpprcpzUafXD09/aQ6TNUdCXvRCiBd+pbj+i9C2W0Z7Mowu667k+jW06cy60lKvzlAit0gITKq2WhGtm2fDkwEgiAIgiAIgliHLn8AKSCcApR8l94AAAAASUVORK5CYII=
                            <%}%>' alt="photo here" >
                        </td>
                        <td style="font-weight: bold;color: <%if(product.currentQty > 5) {%>
                            greenyellow
                        <%}else{%>
                        red
                        <%}%>;">
                           <input type="number"  <%if(product.isActivated){%>
                            disabled
                        <%}%> data-id="<%=product._id%>"  id="Cartorn" value=<%=product.currentQty%>>
                        </td>

                        <td style="font-weight: bold;color: <%if(product.currentQty > 0) {%>
                            greenyellow
                        <%}else{%>
                        red
                        <%}%>;">
                            <!-- ware house qty -->
                            <input type="number" 
                            <%if(product.isActivated){%>
                              disabled
                          <%}%>
                             id="Roll" data-id="<%=product._id%>"  value=<%=product.Rolls%> id="">
                        </td>
                        <td>
                            <div class="divTableCell">&nbsp;
                                <label class="switch" title="Toogle to Activate or Deactivate this Product On Invoice Builder">
                                    <input type="checkbox"  data-id="<%=product._id%>"  id="toggleReplenish" Name="AutoReplenish" <%if(product.isActivated=== true){%>
                                        checked
                                    <%}%>/>
                                    <div class="slider"></div>
                                </label>
                            </div>
                        </td>
                       
                  </tr>
                 
            <%})%>
        <%}%>  
              </tbody>
            </table>
        </div>  
    </div>
   
     <!-- ends here -->
    
     </div>
     </div>
     <!-- ENDS HERE -->
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
        let manager 
        let storeKeeper
       //for managerial role in warehouse
       const managerId = document.getElementById('Manager')
        .addEventListener('change',async function(e){
            const request  = await fetch(`/api/v1/Employee/${e.target.value}`,{
                method:'GET',
                headers:{'Content-Type': 'application/json'}
            })
            const response = await request.json()
            manager = response

        })

        const Store_Keeper = document.getElementById('StoreKeeper')
        .addEventListener('change',async function(e){
            const request  = await fetch(`/api/v1/Employee/${e.target.value}`,{
                method:'GET',
                headers:{'Content-Type': 'application/json'}
            })
            const response = await request.json()
            storeKeeper = response

        })







    //Patch / edit ware house status
      const EditWareHouseForm = document.getElementById('EditWareHouseForm');
      EditWareHouseForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const ADMINID = document.getElementById('ADMINID').value
        const wareHouseId = document.getElementById('WHID').value
        const request = await fetch(`/api/v1/warehouse/${ADMINID}/${wareHouseId}/edit`,{
            body:JSON.stringify({
                WHName:EditWareHouseForm.WHName.value,
                Tel:EditWareHouseForm.Tel.value,
                Email:EditWareHouseForm.Email.value,
                Address:EditWareHouseForm.Address.value,
                Manager:manager,
                Status:EditWareHouseForm.Status.checked,
                state:EditWareHouseForm.state.value,
                StoreKeeper:storeKeeper
            }),
            method:'PATCH',
            headers: {'Content-Type': 'application/json'},
          })
          const response = await request.json().then((res)=>{
            alert(res.result || res.error)
          });  
  
    })
          
    // // sumit outbount form data
    // const outboundForm = document.querySelectorAll('#outbound')

    // for(let i = 0 ; i < outboundForm.length ; i++ ) {
    //     outboundForm[i].addEventListener('submit',async (e)=>{
    //         e.preventDefault();
    //         const outBoundQty = outboundForm[i].outBoundQty.value
    //         const productID = outboundForm[i].product.value
    //         const ADMINID = document.getElementById('ADMINID').value
    //         const wareHouseId = document.getElementById('WHID').value
    //         const storeProductId = outboundForm[i].storeProduct.value
    //         const Batch_Ref = outboundForm[i].Batch_Ref.value
    //         // alert(prompt(outBoundQty))

    //         //send patch to server   /outbound/:ADMINID/:WHID/edit
    //         const request = await fetch(`/outbound/${ADMINID}/${wareHouseId}/${productID}/${storeProductId}/edit`,{
    //         body:JSON.stringify({
    //             pendings:parseInt(outBoundQty),
    //             Batch_Ref
    //         }),
    //         method:'PATCH',
    //         headers: {'Content-Type': 'application/json'},
    //       })
    //       const response = await request.json().then((res)=>{
    //         alert(res.message || res.error)
    //         location.reload()
    //       });  


    //     })
    // }


    //Disable check box for each product 
    let incoming = document.querySelectorAll('#toggleReplenish')
for (let i = 0 ; i < incoming.length ; i++) {
  let confirm = incoming[i].addEventListener('change', async function(e){
      //for batch identifier
      isActivated = e.target.checked
      const url = `/api/v1/warehouse/Product/${incoming[i].dataset.id}`//sends whid

        const update = {isActivated}
        const request = await fetch(url,{
        method:'PATCH',
        body: JSON.stringify({update,message:`Product Activation set to:${isActivated} on ${moment().format('l')}`}),
        headers: {'Content-Type': 'application/json'}
        })
        const respose = await request.json().then((response) => {
                if(response.message){
                    alert(response.message)
                    location.reload()
                }else if (response.error){
                    alert(response.error)
                }
            })
    })

  }

  // update productt qty
  let Cartorn = document.querySelectorAll('#Cartorn')
for (let i = 0 ; i < Cartorn.length ; i++) {
  Cartorn[i].addEventListener('change', async function(e){
      //for batch identifier
      currentQty = e.target.value
      const url = `/api/v1/warehouse/Product/${Cartorn[i].dataset.id}`//sends whid

        const update = {currentQty}
        const request = await fetch(url,{
        method:'PATCH',
        body: JSON.stringify({update,message:`Carton Qty was re-Adjusted to ${currentQty} Carton on ${moment().format('l')}`}),
        headers: {'Content-Type': 'application/json'}
        })
        const respose = await request.json().then((response) => {
                if(response.message){
                    alert(response.message)
                    // qtyApproved = ''
                    // location.reload()
                }else if (response.error){
                    alert(response.error)
                }
            })
    })

  }

   // update Rolls qty
   let Roll = document.querySelectorAll('#Roll')
for (let i = 0 ; i < Roll.length ; i++) {
  Roll[i].addEventListener('change', async function(e){
      //for batch identifier
      Rolls = e.target.value
      const url = `/api/v1/warehouse/Product/${Roll[i].dataset.id}`//sends whid

        const update = {Rolls}
        const request = await fetch(url,{
        method:'PATCH',
        body: JSON.stringify({update,message:`Roll Qty was re-Adjusted to ${Rolls} Roll, on ${moment().format('l')}`}),
        headers: {'Content-Type': 'application/json'}
        })
        const respose = await request.json().then((response) => {
                if(response.message){
                    alert(response.message)
                    // location.reload()
                }else if (response.error){
                    alert(response.error)
                }
            })
    })

  }
</script>
</html>
 