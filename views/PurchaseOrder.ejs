<!DOCTYPE html>
<html lang="en">
  <%-include('./partials/head.ejs')%>
  <%-include('./partials/inactive.ejs')%>
  <body>
    <nav class="navbar bg-black">
      <div class="container-fluid">
        <span class="navbar-brand" onclick="history.back()"  title="Back">
          <img 
          width="30"
          hegith="30"
          src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEgklEQVR4nO2a/U/VVRzH31xEbjxEQmjYAobWUkdYIiYxYYg8c+/9HrqUhAaFbvaE60lnOVzTrRbFMCZjNkmvGV6433NjjY2W1WzrgVHNkq0VtkxXZmqaUwyBTzv0Zd01TO4ZP3zP5b628we8vp/z9P5+DhAkSJAgUw1RyPpWCsN0wOmmUI1TK+Pkzf6IZiCQcbpppqZTO+NEYmicXPX1ZEEgUtpFEYxT97isz2hGoOF0UxTjdGgC2fFKb0Og4HRTLOP0xbVkfcYzUB3NQwmM07eTkCWm0yjj9ChUhXVSisbp2KRk/53aw5pOTqiGndNiptMpf2R9pLdDJRw6ZTBOZ2Rkcxu+PAhAnQuJ5qFcjdNFv2V1Gl2+me8FsBpAJlTAoZNd4zTo9xTWR0bS6/a1GLI2ANEwO4zTGqbTVb9lPcNDd9U2vW7IlgCIgNnROD1pHCl+yTo6hwYXVr60w5AtABAOs6Nx2iSzOdk7rlycX/b0VkN2pfk3KqIQplOjjKyt/dIfibk1zxuyKwCEwuzxjum0R0a27O0LpxMy7Bt9dmNzJ6XCbgpnnDwysqWucyfjFq14zJBNBxACM1PVQ5GM0/sysiV7Tw/EJKetM2TTYHZK3qNZjNNnMrJFu0/0R8xJqTFkF8DsON10i6bTERnZgpZjfdbo+LUAHgQwD2bHzilZ0+kHGdm8nf2fWKyRVQAeAJAIs+P00kJNp5MysrkNfT0WS1glgAoACTA75V5KZzr9LiObveNwl7FeywHEw+yUc8phOv0plXi2dLkMWQ3ALJgdxqlMNvEsrXO1GrJ2JRLPFAmrkXh8CE2rbdro6PhrUGZK29svizuyUtwtpuW84sdfcBwc9H8d/yP+MhQiFECOkE7MrnrW9s6ls1LSnJpVaqFYANwnpOcsKX6qdP952b+PLpWaZSEAlgrpuDsyN5TsO3Nccnq/+3AbWaEQi4V0VOKi2uK2X6WumJpOH9q8pMYxZbBQSEfE31ZduPv4N5JrutehUxwUYr5IPGHRsWvzd33fK1npfpuX5kIhkkTysYRZH1rZeORjSekfHTqZPyb6ICpUAYulMueVzydqbk9m/GLnlAqFmA3gfrGuM7d2H5A8ss5qHroXChErrt5Cetkmz1syP+LHelBeyoNC3Ggko9VLntizS9NHhiXO6Sual0SUVIZI8V5FSKc+0tjg8Fwdkqi0+FDVUAgrgCIhfWdF/XbRM5Ko9CjTqQ4KMRPAKiGdUlr3ot096H+PWMGkNWM8aSXlr99sb798fjo8ebAAyBLSCem2urIDF36bDo9aQgBkjCWtBVkbSl3nfp7sOl72XMcbyvwPm4B7hHRMYuq6krZTA9cTXr6la79Sbzz+P2kl1RS9eeLotWSztn3Qacjmm785fn1uF0krPHZudWHrT1//Vzbn1d4eQ7ZYiWcPkyR5LF5G3LRmVfN3n47L5jUdPWy0ZMoA3IAA41aRtES8zH3tq0MFLQN9RrPNASAKAcrssaRlsVSGWaOrjP6T+VsyU5S0RGfxZkwTYoxqBwkC//gbNIgEXXRi6msAAAAASUVORK5CYII=">
         </span>
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item dropdown">
            <h5>
              <a
                class="nav-link breadcrumb-item active"
                aria-current="page"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                style="color: #fff !important"
              >
               Purchase Orders
              </a>
            </h5>
          </li>
        </ul>
        <div class="d-flex justify-content-between flex-wrap d-flex gap-3 align-items-center" style="color: rgb(163, 163, 91);">
          <img class="rounded shadow" width="30" height="30" src="
          <%if(user.image){%>
            <%= user.image %>
            <%}else{%>
                https://cdn.pixabay.com/photo/2019/08/11/18/59/icon-4399701_640.png
            <%}%>
          "  alt="display photo" srcset="">
          <h6 style="color: rgb(163, 163, 91);"><%=user.firstName.toUpperCase().charAt(0)%><%=user.firstName.substring(1,20)%> <%=user.lastName.toUpperCase().charAt(0)%><%=user.lastName.substring(1,20)%></h6>
                <input type="text" id="products" class="form-input rounded p-2" list="productsACD" name="referenceNo" placeholder="Search P/O ReferenceNo" />
                <datalist id="productsACD" >
                 <!-- display options for Bills -->
                 <%searchAllPurchase.forEach((order)=>{%>
                       <option value="<%=order._id%>"><%=order.billReferenceNo%></option>
                     <%})%>
                </datalist>
            </div>
      </div>
    </nav>
     <!--bread crum div -->
     <div class="d-flex justify-content-between p-2 m-1 bg-success-subtle ">
        <h5 class="font-bold"></h5>
        
        <%if( user.jobTittle === "Invoicer" || user.role === "Admin" ||user.jobTittle === "CFO"){%>
         <button class="btn btn-success" onclick="location.assign('/api/v1/purchase/<%=user._id%>')">Generate LPO</button>
        <%}%> 
       </div>
    <div class="h-59 p-1 d-flex flex-column" >
        <%if(result.purchaseOrder.length > 0){%>
            <%result.purchaseOrder.forEach(purchase=>{%>
                <span  class="list-group position-relative mb-2" title="P/O <%=purchase.billReferenceNo%>">
                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center" >
                        <small class="position-absolute top-0  start-50 translate-middle badge rounded-pill bg-warning"title='P/O has been registered in virtual ware house'>
                          <span class="badge bg-secondary">
                             <%=purchase.status.toUpperCase()%>
                          </span>
                        </small>
                        <% vend = vendor.filter(vendor=>{%>
                          <%return vendor._id.toString() === purchase.Vendor.toString()  %>
                          <%})%>
                          <%vend.map(name=>{%>
                           <h6>
                            <a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="/api/v1/Purchase/bill/<%=purchase._id%>">GRN/<%=purchase.billReferenceNo%>/<%=name.Name.substring(0,3).toUpperCase()%>/<%=purchase.grandTotal%></a>
                           </h6>
                          <%})%>
                      </div> 
                    </span>
            <%})%>

            <footer class="d-flex justify-content-center">
              <button type="button" class="btn btn-dark shadow-sm me-2"
              <%if(!result.Previous){%>
                disabled
                <%}%>
                <%if(result.Previous){%>
                  onclick="location.assign('/api/v1/Virtual/Purchase/Order/<%=user._id%>/?page=<%=result.Previous.page%>&limit=9')"
                  <%}%>
              >
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-skip-start-btn" viewBox="0 0 16 16">
                <path d="M9.71 5.093a.5.5 0 0 1 .79.407v5a.5.5 0 0 1-.79.407L7 8.972V10.5a.5.5 0 0 1-1 0v-5a.5.5 0 0 1 1 0v1.528z"/>
                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
              </svg>
            </button>
              
              <button type="button" class="btn btn-dark shadow-sm me-2" <%if(!result.next){%>
                disabled =true
                <%}%>
                <%if(result.next){%>
                  onclick="location.assign('/api/v1/Virtual/Purchase/Order/<%=user._id%>/?page=<%=result.next.page%>&limit=9')"
                  <%}%>
                >
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-skip-end-btn" viewBox="0 0 16 16">
                  <path d="M6.79 5.093 9.5 7.028V5.5a.5.5 0 0 1 1 0v5a.5.5 0 0 1-1 0V8.972l-2.71 1.935A.5.5 0 0 1 6 10.5v-5a.5.5 0 0 1 .79-.407"/>
                  <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                </svg>
               </button>
            </footer>

        <%}else{%>
        <div class="container">
            <p>Nothing to show</p>
        </div>
        <%}%>
    </div>

    

     <!-- The Modal -->
 <div id="myModal" class="modal flex items-center flex-col justify-center gap-3 shadow">
  <!-- Modal content -->
  <div class=" modal-content container" style=" background-color: transparent !important; border: none !important;">
      <div class="spinner-border text-info" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden"></span>
   </div>
</div>

    </body>
    <script>
       const products = document.getElementById("products")
    products.addEventListener('change',async(event)=>{
    document.getElementById('myModal').style.display = 'block';
        setTimeout(()=>{
            document.getElementById('myModal').style.display = 'none';
        },3000)
        location.assign(`/api/v1/Purchase/bill/${event.target.value}/`)
    })
    </script>
</html>